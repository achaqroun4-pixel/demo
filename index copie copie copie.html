<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LePanier - Fruits & LÃ©gumes Frais LivrÃ©s</title>
    <style>
        :root {
            --primary-green: #2a9d8f;
            --dark-green: #1e6f5c;
            --light-green: #e9f5db;
            --orange: #e76f51;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #495057;
            --black: #212529;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 24px rgba(0,0,0,0.15);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--black);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .main-header {
            background: var(--white);
            border-bottom: 1px solid var(--medium-gray);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--medium-gray);
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            font-size: 32px;
        }

        .search-contact {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-select {
            padding: 8px 15px;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            background: var(--white);
            color: var(--dark-gray);
        }

        .contact-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--dark-gray);
        }

        .phone-icon {
            color: var(--primary-green);
            font-size: 18px;
        }

        /* Navigation */
        .main-nav {
            padding: 15px 0;
        }

        .nav-list {
            display: flex;
            justify-content: center;
            list-style: none;
            gap: 40px;
        }

        .nav-link {
            text-decoration: none;
            color: var(--dark-gray);
            font-weight: 500;
            transition: var(--transition);
            padding: 5px 0;
            position: relative;
        }

        .nav-link:hover {
            color: var(--primary-green);
        }

        .nav-link.active {
            color: var(--primary-green);
            font-weight: 600;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-green);
        }

        /* Cart Icon */
        .cart-icon-wrapper {
            position: relative;
        }

        .cart-icon {
            font-size: 24px;
            color: var(--dark-gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .cart-icon:hover {
            color: var(--primary-green);
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--orange);
            color: white;
            font-size: 12px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }

        /* Main Content */
        .main-content {
            display: flex;
            gap: 40px;
            padding: 40px 0;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            flex-shrink: 0;
        }

        .categories-section {
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark-gray);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-green);
        }

        .category-list {
            list-style: none;
        }

        .category-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .category-item:hover {
            color: var(--primary-green);
        }

        .category-item.active {
            color: var(--primary-green);
            font-weight: 600;
        }

        .category-count {
            background: var(--primary-green);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* Products Grid */
        .products-section {
            flex: 1;
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: var(--white);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-green);
        }

        .sort-select {
            padding: 10px 15px;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            background: var(--white);
            color: var(--dark-gray);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }

        .product-card {
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-info {
            padding: 20px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark-gray);
        }

        .product-description {
            color: var(--dark-gray);
            opacity: 0.8;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .product-price {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 20px;
        }

        .add-to-cart-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-to-cart-btn:hover {
            background: var(--dark-green);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .quantity-modal {
            background: var(--white);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            overflow: hidden;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: var(--primary-green);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            transform: scale(1.1);
        }

        .modal-content {
            padding: 30px;
        }

        .product-preview {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .preview-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
        }

        .preview-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--dark-gray);
        }

        .preview-info .price {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-green);
        }

        /* Unit Selection */
        .unit-selection {
            margin-bottom: 30px;
        }

        .unit-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark-gray);
        }

        .unit-options {
            display: flex;
            gap: 20px;
        }

        .unit-option {
            flex: 1;
            text-align: center;
        }

        .unit-btn {
            width: 100%;
            padding: 15px;
            background: var(--light-gray);
            border: 2px solid var(--medium-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--dark-gray);
        }

        .unit-btn:hover {
            border-color: var(--primary-green);
            background: rgba(42, 157, 143, 0.1);
        }

        .unit-btn.selected {
            border-color: var(--primary-green);
            background: var(--primary-green);
            color: white;
        }

        .unit-price {
            margin-top: 5px;
            font-size: 14px;
            color: var(--dark-gray);
        }

        /* Quantity Selection */
        .quantity-selection {
            margin-bottom: 30px;
        }

        .quantity-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark-gray);
        }

        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .qty-btn {
            width: 50px;
            height: 50px;
            border: none;
            background: var(--primary-green);
            color: white;
            font-size: 24px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qty-btn:hover {
            background: var(--dark-green);
            transform: scale(1.1);
        }

        .qty-btn:disabled {
            background: var(--medium-gray);
            cursor: not-allowed;
            transform: none;
        }

        .qty-display {
            width: 80px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--dark-gray);
        }

        .total-price {
            text-align: center;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-green);
            margin-top: 15px;
        }

        /* Modal Actions */
        .modal-actions {
            display: flex;
            gap: 15px;
        }

        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .cancel-btn {
            background: var(--light-gray);
            color: var(--dark-gray);
        }

        .cancel-btn:hover {
            background: var(--medium-gray);
        }

        .add-btn {
            background: var(--primary-green);
            color: white;
        }

        .add-btn:hover {
            background: var(--dark-green);
        }

        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: var(--white);
            box-shadow: -5px 0 25px rgba(0,0,0,0.1);
            transition: var(--transition);
            z-index: 1500;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.active {
            right: 0;
        }

        .cart-header {
            padding: 25px;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h2 {
            font-size: 24px;
            color: var(--dark-gray);
        }

        .close-cart {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--dark-gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .close-cart:hover {
            color: var(--orange);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--light-gray);
            border-radius: 8px;
            margin-bottom: 15px;
            transition: var(--transition);
        }

        .cart-item:hover {
            background: var(--medium-gray);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: var(--primary-green);
            font-weight: 700;
        }

        .cart-item-unit {
            font-size: 12px;
            color: var(--dark-gray);
            opacity: 0.8;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-qty-control {
            display: flex;
            align-items: center;
            gap: 5px;
            background: var(--white);
            padding: 5px 10px;
            border-radius: 20px;
        }

        .cart-qty-btn {
            width: 30px;
            height: 30px;
            border: none;
            background: var(--primary-green);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .cart-qty-btn:hover {
            background: var(--dark-green);
        }

        .cart-qty-display {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
        }

        .cart-item-remove {
            background: none;
            border: none;
            color: var(--orange);
            cursor: pointer;
            font-size: 18px;
            transition: var(--transition);
        }

        .cart-item-remove:hover {
            transform: scale(1.1);
        }

        .cart-summary {
            padding: 25px;
            border-top: 1px solid var(--medium-gray);
            background: var(--white);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .summary-row.total {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-green);
            border-top: 2px dashed var(--medium-gray);
            padding-top: 15px;
            margin-top: 15px;
        }

        .checkout-btn {
            width: 100%;
            padding: 15px;
            background: var(--orange);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .checkout-btn:hover {
            background: #d65c3e;
        }

        .checkout-btn:disabled {
            background: var(--medium-gray);
            cursor: not-allowed;
        }

        /* Empty Cart */
        .empty-cart {
            text-align: center;
            padding: 50px 20px;
            color: var(--dark-gray);
        }

        .empty-cart-icon {
            font-size: 60px;
            color: var(--medium-gray);
            margin-bottom: 20px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-contact {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-list {
                flex-wrap: wrap;
                gap: 15px;
                justify-content: center;
            }
            
            .cart-sidebar {
                width: 100%;
                max-width: 400px;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .unit-options {
                flex-direction: column;
            }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow-hover);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 3000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--primary-green);
        }

        .notification.error {
            border-left: 4px solid var(--orange);
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification.success .notification-icon {
            color: var(--primary-green);
        }

        .notification.error .notification-icon {
            color: var(--orange);
        }

        /* Floating Cart Button */
        .floating-cart-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary-green);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(42, 157, 143, 0.3);
            transition: var(--transition);
            z-index: 1000;
        }

        .floating-cart-btn:hover {
            background: var(--dark-green);
            transform: scale(1.1);
        }

        .floating-cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--orange);
            color: white;
            font-size: 12px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="container">
            <div class="header-top">
                <div class="logo">
                    <span class="logo-icon">ðŸ›’</span>
                    <span>LePanier</span>
                </div>
                <div class="search-contact">
                    <div class="search-bar">
                        <select class="category-select">
                            <option>CHOISIR UNE CATÃ‰GORIE...</option>
                            <option value="legumes">LÃ‰GUMES</option>
                            <option value="fruits">FRUITS</option>
                            <option value="herbes">HERBES ET SALADES</option>
                            <option value="epiceries">Ã‰PICERIES</option>
                            <option value="olives">OLIVES</option>
                        </select>
                    </div>
                    <div class="contact-info">
                        <span class="phone-icon">ðŸ“ž</span>
                        <div>
                            <div style="font-size: 12px; color: #666;">Des Questions ?</div>
                            <div style="font-weight: 600;">+212666665000</div>
                        </div>
                    </div>
                </div>
                <div class="cart-icon-wrapper">
                    <div class="cart-icon" id="cartIcon">ðŸ›’</div>
                    <div class="cart-count" id="cartCount">0</div>
                </div>
            </div>
            
            <nav class="main-nav">
                <ul class="nav-list">
                    <li><a href="#" class="nav-link active">ACCUEIL</a></li>
                    <li><a href="#legumes" class="nav-link">LÃ‰GUMES</a></li>
                    <li><a href="#fruits" class="nav-link">FRUITS</a></li>
                    <li><a href="#herbes" class="nav-link">HERBES ET SALADES</a></li>
                    <li><a href="#epiceries" class="nav-link">Ã‰PICERIES</a></li>
                    <li><a href="#olives" class="nav-link">OLIVES</a></li>
                    <li><a href="#" class="nav-link">NOS PANIERS</a></li>
                    <li><a href="#" class="nav-link">BLOG</a></li>
                    <li><a href="#" class="nav-link">Ã€ PROPOS</a></li>
                    <li><a href="#" class="nav-link">CONTACT</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="categories-section">
                    <h2 class="section-title">NOS RAYONS</h2>
                    <ul class="category-list" id="categoryList">
                        <!-- Categories will be populated by JavaScript -->
                    </ul>
                </div>
            </aside>

            <!-- Products Section -->
            <section class="products-section">
                <div class="products-header">
                    <h1 class="page-title" id="pageTitle">- LÃ‰GUMES</h1>
                    <select class="sort-select" id="sortSelect">
                        <option>Tri par dÃ©faut</option>
                        <option>Prix croissant</option>
                        <option>Prix dÃ©croissant</option>
                        <option>Nom A-Z</option>
                    </select>
                </div>

                <div class="products-grid" id="productsGrid">
                    <!-- Products will be populated by JavaScript -->
                </div>
            </section>
        </div>
    </main>

    <!-- Quantity Modal -->
    <div class="modal-overlay" id="quantityModal">
        <div class="quantity-modal">
            <div class="modal-header">
                <h3 class="modal-title">Ajouter au panier</h3>
                <button class="close-modal" id="closeModal">Ã—</button>
            </div>
            <div class="modal-content" id="modalContent">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2>Mon Panier</h2>
            <button class="close-cart" id="closeCart">Ã—</button>
        </div>
        <div class="cart-items" id="cartItems">
            <!-- Cart items will be populated by JavaScript -->
        </div>
        <div class="cart-summary">
            <div class="summary-row">
                <span>Sous-total</span>
                <span id="subtotalPrice">0.00 DH</span>
            </div>
            <div class="summary-row">
                <span>Livraison</span>
                <span id="deliveryPrice">0.00 DH</span>
            </div>
            <div class="summary-row total">
                <span>TOTAL</span>
                <span id="totalPrice">0.00 DH</span>
            </div>
            <button class="checkout-btn" id="checkoutBtn">
                <span>ðŸ›’</span>
                <span>Passer la commande</span>
            </button>
        </div>
    </div>

    <!-- Floating Cart Button -->
    <div class="floating-cart-btn" id="floatingCartBtn">
        ðŸ›’
        <div class="floating-cart-count" id="floatingCartCount">0</div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon">âœ“</div>
        <div>
            <h4 id="notificationTitle">Titre</h4>
            <p id="notificationMessage">Message</p>
        </div>
    </div>

    <script>
        // ============================
        // APPLICATION STATE
        // ============================
        
        const state = {
            currentCategory: 'legumes',
            cart: [],
            currentProduct: null,
            deliveryFee: 20.00,
            freeDeliveryThreshold: 200.00
        };

        // ============================
        // DONNÃ‰ES DE LÃ‰GUMES COMPLÃˆTES
        // ============================

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø¶Ø±ÙˆØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ ØµÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ© (36 produits)
        const vegetablesList = [
            { id: 101, name: 'Ù‚ÙˆÙ‚', subtitle: 'Ù‚ÙˆÙ‚ Ø·Ø§Ø²Ø¬ Ø·Ø±ÙŠ', price: 18, category: 'vegetables', image: 'images/legumes/artichaut.png' },
            { id: 102, name: 'Ø¯Ù†Ø¬Ø§Ù„', subtitle: 'Ø¯Ù†Ø¬Ø§Ù„ Ø¨Ù†ÙØ³Ø¬ÙŠ Ø·Ø§Ø²Ø¬', price: 13, category: 'vegetables', image: 'images/legumes/aubergine.png' },
            { id: 103, name: 'Ø¨Ø§Ø±Ø¨Ø§', subtitle: 'Ø¨Ø§Ø±Ø¨Ø§ Ø·Ø§Ø²Ø¬Ø© Ø·Ø±ÙŠØ©', price: 11, category: 'vegetables', image: 'images/legumes/betterave.png' },
            { id: 104, name: 'Ø§Ù„Ø¨Ø±ÙˆÙƒÙ„ÙŠ', subtitle: 'Ø§Ù„Ø¨Ø±ÙˆÙƒÙ„ÙŠ Ø£Ø®Ø¶Ø± Ø·Ø§Ø²Ø¬', price: 16, category: 'vegetables', image: 'images/legumes/brocoli.png' },
            { id: 105, name: 'Ø§Ù„Ø®Ø±Ø´ÙˆÙ', subtitle: 'Ø§Ù„Ø®Ø±Ø´ÙˆÙ Ø·Ø§Ø²Ø¬', price: 20, category: 'vegetables', image: 'images/legumes/cardon.png' },
            { id: 106, name: 'Ø¬Ø²Ø±', subtitle: 'Ø¬Ø²Ø± Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø·Ø§Ø²Ø¬ Ø­Ù„Ùˆ', price: 10, category: 'vegetables', image: 'images/legumes/carotte.png' },
            { id: 107, name: 'ÙØ·Ø± Ø£Ø¨ÙŠØ¶', subtitle: 'ÙØ·Ø± Ø£Ø¨ÙŠØ¶ Ø·Ø§Ø²Ø¬', price: 25, category: 'vegetables', image: 'images/legumes/champignon_blanc.png' },
            { id: 108, name: 'Ø´ÙˆÙÙ„ÙˆØ±', subtitle: 'Ø´ÙˆÙÙ„ÙˆØ± Ø£Ø¨ÙŠØ¶ Ø·Ø§Ø²Ø¬', price: 17, category: 'vegetables', image: 'images/legumes/choux_fleur.png' },
            { id: 109, name: 'ÙƒØ±ÙˆÙ… Ø®Ø¶Ø±Ø§Ø¡', subtitle: 'ÙƒØ±ÙˆÙ… Ø®Ø¶Ø±Ø§Ø¡ Ø·Ø§Ø²Ø¬Ø©', price: 12, category: 'vegetables', image: 'images/legumes/choux_vert.png' },
            { id: 110, name: 'Ø³ÙØ±Ø¬Ù„', subtitle: 'Ø³ÙØ±Ø¬Ù„ Ø·Ø§Ø²Ø¬', price: 22, category: 'vegetables', image: 'images/legumes/coing.png' },
            { id: 111, name: 'Ø®ÙŠØ§Ø±', subtitle: 'Ø®ÙŠØ§Ø± Ø·Ø§Ø²Ø¬ Ù…Ù‚Ø±Ù…Ø´', price: 9, category: 'vegetables', image: 'images/legumes/concombre.png' },
            { id: 112, name: 'ÙƒØ±Ø¹Ø© Ø®Ø¶Ø±Ø©', subtitle: 'ÙƒØ±Ø¹Ø© Ø®Ø¶Ø±Ø§Ø¡ Ø·Ø±ÙŠØ©', price: 14, category: 'vegetables', image: 'images/legumes/courgette.png' },
            { id: 113, name: 'ÙƒØ±Ø¹Ø© Ù…Ø¯ÙˆØ±Ø©', subtitle: 'ÙƒØ±Ø¹Ø© Ù…Ø¯ÙˆØ±Ø© Ø®Ø¶Ø±Ø§Ø¡', price: 15, category: 'vegetables', image: 'images/legumes/courgette_ronde.png' },
            { id: 114, name: 'Ø¨Ø³Ø¨Ø§Ø³', subtitle: 'Ø¨Ø³Ø¨Ø§Ø³ Ø·Ø§Ø²Ø¬', price: 12, category: 'vegetables', image: 'images/legumes/fenouil.png' },
            { id: 115, name: 'ÙÙˆÙ„', subtitle: 'ÙÙˆÙ„ Ø·Ø§Ø²Ø¬', price: 19, category: 'vegetables', image: 'images/legumes/feves.png' },
            { id: 116, name: 'Ø³ÙƒÙŠÙ†Ø¬Ø¨ÙŠØ±', subtitle: 'Ø³ÙƒÙŠÙ†Ø¬Ø¨ÙŠØ± Ø·Ø§Ø²Ø¬', price: 24, category: 'vegetables', image: 'images/legumes/gingembre.png' },
            { id: 117, name: 'Ù„ÙˆØ¨ÙŠØ§ Ø®Ø¶Ø±Ø§Ø¡', subtitle: 'Ù„ÙˆØ¨ÙŠØ§ Ø®Ø¶Ø±Ø§Ø¡ Ø·Ø±ÙŠØ©', price: 16, category: 'vegetables', image: 'images/legumes/haricot_vert.png' },
            { id: 118, name: 'Ù„ÙØª Ø£Ø¨ÙŠØ¶', subtitle: 'Ù„ÙØª Ø£Ø¨ÙŠØ¶ Ø·Ø§Ø²Ø¬', price: 8, category: 'vegetables', image: 'images/legumes/navet_blanc.png' },
            { id: 119, name: 'Ù„ÙØª Ø£ØµÙØ±', subtitle: 'Ù„ÙØª Ø£ØµÙØ± Ø·Ø§Ø²Ø¬', price: 9, category: 'vegetables', image: 'images/legumes/navet_jaune.png' },
            { id: 120, name: 'Ù„ÙØª', subtitle: 'Ù„ÙØª Ø£Ø­Ù…Ø± Ø·Ø§Ø²Ø¬', price: 10, category: 'vegetables', image: 'images/legumes/navet_rouge.png' },
            { id: 121, name: 'Ø¨ØµÙ„Ø©', subtitle: 'Ø¨ØµÙ„ Ø£Ø¨ÙŠØ¶ Ø·Ø§Ø²Ø¬', price: 6, category: 'vegetables', image: 'images/legumes/oignon_blanc.png' },
            { id: 122, name: 'Ø¨ØµÙ„Ø© Ø­Ù…Ø±Ø§Ø¡', subtitle: 'Ø¨ØµÙ„ Ø£Ø­Ù…Ø± Ø·Ø§Ø²Ø¬', price: 7, category: 'vegetables', image: 'images/legumes/oignon_rouge.png' },
            { id: 123, name: 'Ø¨ØµÙ„Ø© Ø®Ø¶Ø§Ø±ÙŠØ©', subtitle: 'Ø¨ØµÙ„ Ø£Ø­Ù…Ø± Ø®Ø¶Ø§Ø±ÙŠ', price: 8, category: 'vegetables', image: 'images/legumes/oignons_rouge.png' },
            { id: 124, name: 'Ø¨Ø·Ø§Ø·Ø© Ø­Ù„ÙˆØ©', subtitle: 'Ø¨Ø·Ø§Ø·Ø© Ø­Ù„ÙˆØ© Ø·Ø§Ø²Ø¬Ø©', price: 14, category: 'vegetables', image: 'images/legumes/patate_douce.png' },
            { id: 125, name: 'Ø¬Ù„Ø¨Ø§Ù†Ø©', subtitle: 'Ø¬Ù„Ø¨Ø§Ù†Ø© Ø®Ø¶Ø±Ø§Ø¡ Ø·Ø§Ø²Ø¬Ø©', price: 18, category: 'vegetables', image: 'images/legumes/petits_pois.png' },
            { id: 126, name: 'Ø¨ÙˆØ±Ùˆ', subtitle: 'Ø¨ÙˆØ±Ùˆ Ø£Ø®Ø¶Ø± Ø·Ø§Ø²Ø¬', price: 11, category: 'vegetables', image: 'images/legumes/poireau.png' },
            { id: 127, name: 'ÙÙ„ÙÙ„ Ø£ØµÙØ±', subtitle: 'ÙÙ„ÙÙ„ Ø£ØµÙØ± Ø·Ø±ÙŠ', price: 15, category: 'vegetables', image: 'images/legumes/poivron_jaune_drago.png' },
            { id: 128, name: 'ÙÙ„ÙÙ„ Ø£Ø­Ù…Ø±', subtitle: 'ÙÙ„ÙÙ„ Ø£Ø­Ù…Ø± Ø·Ø±ÙŠ', price: 16, category: 'vegetables', image: 'images/legumes/poivron_rouge_drago.png' },
            { id: 129, name: 'ÙÙ„ÙÙ„ Ø£Ø®Ø¶Ø±', subtitle: 'ÙÙ„ÙÙ„ Ø£Ø®Ø¶Ø± Ø·Ø±ÙŠ', price: 13, category: 'vegetables', image: 'images/legumes/poivron_vert.png' },
            { id: 130, name: 'Ø¨Ø·Ø§Ø·Ø© Ø¨ÙŠØ¶Ø§Ø¡', subtitle: 'Ø¨Ø·Ø§Ø·Ø© Ø¨ÙŠØ¶Ø§Ø¡ Ù…Ø­Ù„ÙŠØ©', price: 8, category: 'vegetables', image: 'images/legumes/pomme_de_terre_blanche.png' },
            { id: 131, name: 'Ø¨Ø·Ø§Ø·Ø© ØµØºÙŠØ±Ø©', subtitle: 'Ø¨Ø·Ø§Ø·Ø© ØµØºÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©', price: 9, category: 'vegetables', image: 'images/legumes/pomme_de_terre_nouvelle.png' },
            { id: 132, name: 'Ø§Ù„Ø¨Ø·Ø§Ø·Ø³ Ø§Ù„Ø­Ù…Ø±Ø§Ø¡', subtitle: 'Ø¨Ø·Ø§Ø·Ø³ Ø­Ù…Ø±Ø§Ø¡ Ø·Ø§Ø²Ø¬Ø©', price: 9, category: 'vegetables', image: 'images/legumes/pomme_de_terre_rouge.png' },
            { id: 133, name: 'Ø§Ù„ÙŠÙ‚Ø·ÙŠÙ†', subtitle: 'ÙŠÙ‚Ø·ÙŠÙ† Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø·Ø±ÙŠ', price: 12, category: 'vegetables', image: 'images/legumes/potiron.png' },
            { id: 134, name: 'ÙØ¬Ù„', subtitle: 'ÙØ¬Ù„ Ø£Ø­Ù…Ø± Ø·Ø§Ø²Ø¬', price: 5, category: 'vegetables', image: 'images/legumes/radis.png' },
            { id: 135, name: 'Ù…Ø·ÙŠØ´Ø©', subtitle: 'Ø·Ù…Ø§Ø·Ù… Ø­Ù…Ø±Ø§Ø¡ Ù†Ø§Ø¶Ø¬Ø©', price: 12, category: 'vegetables', image: 'images/legumes/tomate.png' },
            { id: 136, name: 'Ø·Ù…Ø§Ø·Ù… ÙƒØ±Ø²ÙŠØ© Ø­Ù…Ø±Ø§Ø¡', subtitle: 'Ø·Ù…Ø§Ø·Ù… ÙƒØ±Ø²ÙŠØ© Ø­Ù…Ø±Ø§Ø¡ Ø­Ù„ÙˆØ©', price: 20, category: 'vegetables', image: 'images/legumes/tomate_cerise_rouge.png' }
        ];

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙˆØ§ÙƒÙ‡ Ù…Ø¹ ØµÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ©
        const fruitsList = [
            { 
                id: 201, 
                name: 'Ø£Ù†Ø§Ù†Ø§Ø³', 
                subtitle: 'Ø£Ù†Ø§Ù†Ø§Ø³ Ø·Ø§Ø²Ø¬ Ø­Ù„Ùˆ', 
                price: 28, 
                category: 'fruits', 
                image: 'images/fruites/ananas_import.jpg' 
            },
            { 
                id: 202, 
                name: 'Ø£ÙÙˆÙƒØ§', 
                subtitle: 'Ø£ÙÙˆÙƒØ§ Ø·Ø§Ø²Ø¬', 
                price: 35, 
                category: 'fruits', 
                image: 'images/fruites/avocat_fuerte.png' 
            },
            { 
                id: 203, 
                name: 'Ø£ÙÙˆÙƒØ§ Ù‡Ø§Ø³', 
                subtitle: 'Ø£ÙÙˆÙƒØ§ Ù‡Ø§Ø³ Ø·Ø§Ø²Ø¬', 
                price: 38, 
                category: 'fruits', 
                image: 'images/fruites/avocat_hass.png' 
            },
            { 
                id: 204, 
                name: 'Ù…ÙˆØ²', 
                subtitle: 'Ù…ÙˆØ² Ù…Ø³ØªÙˆØ±Ø¯ Ø·Ø§Ø²Ø¬', 
                price: 15, 
                category: 'fruits', 
                image: 'images/fruites/banane_import.png' 
            },
            { 
                id: 205, 
                name: 'Ù…ÙˆØ² Ù…ØºØ±Ø¨ÙŠ', 
                subtitle: 'Ù…ÙˆØ² Ù…ØºØ±Ø¨ÙŠ Ø·Ø§Ø²Ø¬', 
                price: 12, 
                category: 'fruits', 
                image: 'images/fruites/banane_maroc.png' 
            },
            { 
                id: 206, 
                name: 'Ø­Ø§Ù…Ø¶ Ø£ØµÙØ±', 
                subtitle: 'Ø­Ø§Ù…Ø¶ Ø£ØµÙØ± Ø·Ø§Ø²Ø¬', 
                price: 10, 
                category: 'fruits', 
                image: 'images/fruites/citron_jaune.png' 
            },
            { 
                id: 207, 
                name: 'ÙØ§ÙƒÙ‡Ø© Ø§Ù„ØªÙ†ÙŠÙ†', 
                subtitle: 'ÙØ§ÙƒÙ‡Ø© Ø§Ù„ØªÙ†ÙŠÙ† Ø­Ù…Ø±Ø§Ø¡', 
                price: 45, 
                category: 'fruits', 
                image: 'images/fruites/dragon_fruit.png' 
            },
            { 
                id: 208, 
                name: 'ÙØ±Ø§ÙˆÙ„Ø©', 
                subtitle: 'ÙØ±Ø§ÙˆÙ„Ø© Ø­Ù…Ø±Ø§Ø¡ Ø­Ù„ÙˆØ©', 
                price: 30, 
                category: 'fruits', 
                image: 'images/fruites/fraises.png' 
            },
            { 
                id: 209, 
                name: 'ÙØºÙ…Ø¨ÙˆØ§Ø²', 
                subtitle: 'ÙØºÙ…Ø¨ÙˆØ§Ø² Ø·Ø§Ø²Ø¬', 
                price: 40, 
                category: 'fruits', 
                image: 'images/fruites/framboises.png' 
            },
            { 
                id: 210, 
                name: 'ÙƒØ§ÙƒÙŠ', 
                subtitle: 'ÙƒØ§ÙƒÙŠ Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø·Ø§Ø²Ø¬', 
                price: 25, 
                category: 'fruits', 
                image: 'images/fruites/kaki.png' 
            },
            { 
                id: 211, 
                name: 'ÙƒÙŠÙˆÙŠ', 
                subtitle: 'ÙƒÙŠÙˆÙŠ Ø£Ø®Ø¶Ø± Ø·Ø§Ø²Ø¬', 
                price: 24, 
                category: 'fruits', 
                image: 'images/fruites/kiwi.png' 
            },
            { 
                id: 212, 
                name: 'Ù…Ø§Ù†ØºØ§', 
                subtitle: 'Ù…Ø§Ù†ØºØ§ Ø·Ø§Ø²Ø¬Ø© Ø­Ù„ÙˆØ©', 
                price: 35, 
                category: 'fruits', 
                image: 'images/fruites/mangue.png' 
            },
            { 
                id: 213, 
                name: 'Ø¨Ø±ØªÙ‚Ø§Ù„ Ù†Ø§ÙÙŠÙ„', 
                subtitle: 'Ø¨Ø±ØªÙ‚Ø§Ù„ Ù†Ø§ÙÙŠÙ„ Ø­Ù„Ùˆ', 
                price: 12, 
                category: 'fruits', 
                image: 'images/fruites/orange_navel.png' 
            },
            { 
                id: 214, 
                name: 'Ø¥Ø¬Ø§Øµ', 
                subtitle: 'Ø¥Ø¬Ø§Øµ Ø·Ø§Ø²Ø¬ ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ', 
                price: 20, 
                category: 'fruits', 
                image: 'images/fruites/poire_classique.png' 
            },
            { 
                id: 215, 
                name: 'Ø¥Ø¬Ø§Øµ ÙˆÙŠÙ„ÙŠØ§Ù…', 
                subtitle: 'Ø¥Ø¬Ø§Øµ ÙˆÙŠÙ„ÙŠØ§Ù… Ø·Ø§Ø²Ø¬', 
                price: 22, 
                category: 'fruits', 
                image: 'images/fruites/poire_william.png' 
            },
            { 
                id: 216, 
                name: 'ØªÙØ§Ø­ Ø¬Ø§Ù„Ø§', 
                subtitle: 'ØªÙØ§Ø­ Ø¬Ø§Ù„Ø§ Ù…Ù‚Ø±Ù…Ø´', 
                price: 18, 
                category: 'fruits', 
                image: 'images/fruites/pomme_gala.png' 
            },
            { 
                id: 217, 
                name: 'ØªÙØ§Ø­ Ø£ØµÙØ±', 
                subtitle: 'ØªÙØ§Ø­ Ø£ØµÙØ± Ø°Ù‡Ø¨ÙŠ', 
                price: 20, 
                category: 'fruits', 
                image: 'images/fruites/pomme_golden_jaune.png' 
            },
            { 
                id: 218, 
                name: 'ØªÙØ§Ø­ Ø£Ø­Ù…Ø±', 
                subtitle: 'ØªÙØ§Ø­ Ø£Ø­Ù…Ø± Ù…Ù‚Ø±Ù…Ø´', 
                price: 19, 
                category: 'fruits', 
                image: 'images/fruites/pomme_rouge.png' 
            },
            { 
                id: 219, 
                name: 'ØªÙØ§Ø­ Ø£Ø®Ø¶Ø±', 
                subtitle: 'ØªÙØ§Ø­ Ø£Ø®Ø¶Ø± Ø­Ø§Ù…Ø¶', 
                price: 17, 
                category: 'fruits', 
                image: 'images/fruites/pomme_vert.png' 
            }
        ];

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø´Ø§Ø¨ ÙˆØ§Ù„Ø®Ø¶Ø±ÙˆØ§Øª Ø§Ù„ÙˆØ±Ù‚ÙŠØ© Ù…Ø¹ ØµÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ©
        const herbsList = [
            { 
                id: 301, 
                name: 'Ø´ÙŠØ­', 
                subtitle: 'Ø´ÙŠØ­ Ø·Ø§Ø²Ø¬', 
                price: 3.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/absinthe.png' 
            },
            { 
                id: 302, 
                name: 'Ø´Ø¨Øª', 
                subtitle: 'Ø´Ø¨Øª Ø·Ø§Ø²Ø¬', 
                price: 12.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/aneth.png' 
            },
            { 
                id: 303, 
                name: 'Ù‡Ù„ÙŠÙˆÙ†', 
                subtitle: 'Ù‡Ù„ÙŠÙˆÙ† Ø·Ø§Ø²Ø¬', 
                price: 68.00, 
                category: 'herbs', 
                unit: 'KG',
                image: 'images/herbes/asperge.png' 
            },
            { 
                id: 304, 
                name: 'Ø±ÙŠØ­Ø§Ù†', 
                subtitle: 'Ø±ÙŠØ­Ø§Ù† Ø·Ø§Ø²Ø¬', 
                price: 12.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/basilic.png' 
            },
            { 
                id: 305, 
                name: 'Ø¨Ø§Ù‚Ø© Ø£Ø¹Ø´Ø§Ø¨ Ø¹Ø·Ø±ÙŠØ©', 
                subtitle: 'Ø¨Ø§Ù‚Ø© Ø£Ø¹Ø´Ø§Ø¨ Ù…ØªÙ†ÙˆØ¹Ø©', 
                price: 7.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/bouquet_aromatique.png' 
            },
            { 
                id: 306, 
                name: 'ÙƒØ±ÙØ³', 
                subtitle: 'ÙƒØ±ÙØ³ Ø·Ø§Ø²Ø¬', 
                price: 3.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/celeri.png' 
            },
            { 
                id: 307, 
                name: 'Ø«ÙˆÙ… Ù…Ø¹Ù…Ø±', 
                subtitle: 'Ø«ÙˆÙ… Ù…Ø¹Ù…Ø± Ø·Ø§Ø²Ø¬', 
                price: 12.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/ciboulette.png' 
            },
            { 
                id: 308, 
                name: 'ÙƒØ²Ø¨Ø±Ø©', 
                subtitle: 'ÙƒØ²Ø¨Ø±Ø© Ø·Ø§Ø²Ø¬Ø©', 
                price: 5.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/coriandre.png' 
            },
            { 
                id: 309, 
                name: 'Ø³Ø¨Ø§Ù†Ø®', 
                subtitle: 'Ø³Ø¨Ø§Ù†Ø® Ø·Ø§Ø²Ø¬', 
                price: 21.00, 
                category: 'herbs', 
                unit: 'KG',
                image: 'images/herbes/epinard.png' 
            },
            { 
                id: 310, 
                name: 'Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø´Ù…Ù†Ø¯Ø±', 
                subtitle: 'Ø£ÙˆØ±Ø§Ù‚ Ø´Ù…Ù†Ø¯Ø± Ø·Ø§Ø²Ø¬Ø©', 
                price: 16.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/feuilles_betterave.png' 
            },
            { 
                id: 311, 
                name: 'Ø®Ø³', 
                subtitle: 'Ø®Ø³ Ø·Ø§Ø²Ø¬ Ù…Ù‚Ø±Ù…Ø´', 
                price: 9.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/laitue.png' 
            },
            { 
                id: 312, 
                name: 'Ù†Ø¹Ù†Ø§Ø¹', 
                subtitle: 'Ù†Ø¹Ù†Ø§Ø¹ Ø·Ø§Ø²Ø¬', 
                price: 5.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/menthe.png' 
            },
            { 
                id: 313, 
                name: 'Ø¨Ø±Ø§Ø¹Ù… ØµØºÙŠØ±Ø©', 
                subtitle: 'Ø¨Ø±Ø§Ø¹Ù… ØµØºÙŠØ±Ø© Ø·Ø§Ø²Ø¬Ø©', 
                price: 31.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/micro_pousse_barquet.png' 
            },
            { 
                id: 314, 
                name: 'Ø¨Ù‚Ø¯ÙˆÙ†Ø³', 
                subtitle: 'Ø¨Ù‚Ø¯ÙˆÙ†Ø³ Ø·Ø§Ø²Ø¬', 
                price: 5.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/persil.png' 
            },
            { 
                id: 315, 
                name: 'Ø¥ÙƒÙ„ÙŠÙ„ Ø§Ù„Ø¬Ø¨Ù„', 
                subtitle: 'Ø¥ÙƒÙ„ÙŠÙ„ Ø§Ù„Ø¬Ø¨Ù„ Ø·Ø§Ø²Ø¬', 
                price: 12.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/romarin.png' 
            },
            { 
                id: 316, 
                name: 'Ø¬Ø±Ø¬ÙŠØ±', 
                subtitle: 'Ø¬Ø±Ø¬ÙŠØ± Ø·Ø§Ø²Ø¬', 
                price: 21.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/roquette.png' 
            },
            { 
                id: 317, 
                name: 'Ø²Ø¹ØªØ±', 
                subtitle: 'Ø²Ø¹ØªØ± Ø·Ø§Ø²Ø¬', 
                price: 12.00, 
                category: 'herbs', 
                unit: 'U',
                image: 'images/herbes/thym.png' 
            }
        ];

        // ============================
        // PRODUCT DATABASE
        // ============================

        // Conversion de vegetablesList vers productDatabase
        const convertVegetablesToDatabase = (list) => {
            const frenchNames = {
                'artichaut.png': 'ARTICHAUT',
                'aubergine.png': 'AUBERGINE',
                'betterave.png': 'BETTERAVE',
                'brocoli.png': 'BROCOLI',
                'cardon.png': 'CARDON',
                'carotte.png': 'CAROTTE',
                'champignon_blanc.png': 'CHAMPIGNON BLANC',
                'choux_fleur.png': 'CHOU-FLEUR',
                'choux_vert.png': 'CHOU VERT',
                'coing.png': 'COING',
                'concombre.png': 'CONCOMBRE',
                'courgette.png': 'COURGETTE',
                'courgette_ronde.png': 'COURGETTE RONDE',
                'fenouil.png': 'FENOUIL',
                'feves.png': 'FÃˆVES',
                'gingembre.png': 'GINGEMBRE',
                'haricot_vert.png': 'HARICOT VERT',
                'navet_blanc.png': 'NAVET BLANC',
                'navet_jaune.png': 'NAVET JAUNE',
                'navet_rouge.png': 'NAVET ROUGE',
                'oignon_blanc.png': 'OIGNON BLANC',
                'oignon_rouge.png': 'OIGNON ROUGE',
                'oignons_rouge.png': 'OIGNON ROUGE',
                'patate_douce.png': 'PATATE DOUCE',
                'petits_pois.png': 'PETITS POIS',
                'poireau.png': 'POIREAU',
                'poivron_jaune_drago.png': 'POIVRON JAUNE',
                'poivron_rouge_drago.png': 'POIVRON ROUGE',
                'poivron_vert.png': 'POIVRON VERT',
                'pomme_de_terre_blanche.png': 'POMME DE TERRE BLANCHE',
                'pomme_de_terre_nouvelle.png': 'POMME DE TERRE NOUVELLE',
                'pomme_de_terre_rouge.png': 'POMME DE TERRE ROUGE',
                'potiron.png': 'POTIRON',
                'radis.png': 'RADIS',
                'tomate.png': 'TOMATE',
                'tomate_cerise_rouge.png': 'TOMATE CERISE ROUGE'
            };

            return list.map(item => {
                const fileName = item.image.split('/').pop();
                const frenchName = frenchNames[fileName] || 'LÃ‰GUME';
                
                return {
                    id: item.id,
                    name: `${frenchName} - ${item.name}`,
                    description: item.subtitle,
                    priceKg: parseFloat(item.price),
                    priceUnit: null,
                    availableUnits: ['kg'],
                    image: item.image,
                    stockKg: 50 + Math.floor(Math.random() * 50),
                    stockUnit: 0
                };
            });
        };

        // Conversion de fruitsList vers productDatabase
        const convertFruitsToDatabase = (list) => {
            const frenchNames = {
                'ananas_import.jpg': 'ANANAS',
                'avocat_fuerte.png': 'AVOCAT FUERTE',
                'avocat_hass.png': 'AVOCAT HASS',
                'banane_import.png': 'BANANE IMPORT',
                'banane_maroc.png': 'BANANE MAROC',
                'citron_jaune.png': 'CITRON JAUNE',
                'dragon_fruit.png': 'FRUIT DU DRAGON',
                'fraises.png': 'FRAISE',
                'framboises.png': 'FRAMBOISE',
                'kaki.png': 'KAKI',
                'kiwi.png': 'KIWI',
                'mangue.png': 'MANGUE',
                'orange_navel.png': 'ORANGE NAVEL',
                'poire_classique.png': 'POIRE CLASSIQUE',
                'poire_william.png': 'POIRE WILLIAM',
                'pomme_gala.png': 'POMME GALA',
                'pomme_golden_jaune.png': 'POMME GOLDEN',
                'pomme_rouge.png': 'POMME ROUGE',
                'pomme_vert.png': 'POMME VERTE'
            };

            return list.map(item => {
                const fileName = item.image.split('/').pop();
                const frenchName = frenchNames[fileName] || 'FRUIT';
                
                return {
                    id: item.id,
                    name: `${frenchName} - ${item.name}`,
                    description: item.subtitle,
                    priceKg: parseFloat(item.price),
                    priceUnit: null,
                    availableUnits: ['kg'],
                    image: item.image,
                    stockKg: 50 + Math.floor(Math.random() * 50),
                    stockUnit: 0
                };
            });
        };

        // Conversion de herbsList vers productDatabase
        const convertHerbsToDatabase = (list) => {
            const frenchNames = {
                'absinthe.png': 'ABSINTHE',
                'aneth.png': 'ANETH',
                'asperge.png': 'ASPERGE',
                'basilic.png': 'BASILIC',
                'bouquet_aromatique.png': 'BOUQUET AROMATIQUE',
                'celeri.png': 'CELERI',
                'ciboulette.png': 'CIBOULETTE',
                'coriandre.png': 'CORIANDRE',
                'epinard.png': 'Ã‰PINARD',
                'feuilles_betterave.png': 'FEUILLES DE BETTERAVE',
                'laitue.png': 'LAITUE',
                'menthe.png': 'MENTHE',
                'micro_pousse_barquet.png': 'MICRO POUSSES',
                'persil.png': 'PERSIL',
                'romarin.png': 'ROMARIN',
                'roquette.png': 'ROQUETTE',
                'thym.png': 'THYM'
            };

            return list.map(item => {
                const fileName = item.image.split('/').pop();
                const frenchName = frenchNames[fileName] || 'HERBE';
                
                // Determine if it's sold by unit or kg based on the unit field
                const isUnit = item.unit === 'U';
                const isKg = item.unit === 'KG';
                
                return {
                    id: item.id,
                    name: `${frenchName} - ${item.name}`,
                    description: item.subtitle,
                    priceKg: isKg ? parseFloat(item.price) : null,
                    priceUnit: isUnit ? parseFloat(item.price) : null,
                    availableUnits: isUnit ? ['unit'] : ['kg'],
                    image: item.image,
                    stockKg: isKg ? (20 + Math.floor(Math.random() * 30)) : 0,
                    stockUnit: isUnit ? (30 + Math.floor(Math.random() * 70)) : 0
                };
            });
        };

        const productDatabase = {
            legumes: convertVegetablesToDatabase(vegetablesList),

            fruits: convertFruitsToDatabase(fruitsList),

            herbes: convertHerbsToDatabase(herbsList),

            epiceries: [
                { id: 401, name: 'HUILE D\'OLIVE - Ø²ÙŠØª Ø§Ù„Ø²ÙŠØªÙˆÙ†', description: 'Huile d\'olive extra vierge', priceKg: null, priceUnit: 45.00, availableUnits: ['unit'], image: 'https://via.placeholder.com/400x300/f4a261/000000?text=HUILE+D\'OLIVE', stockKg: 0, stockUnit: 30 },
                { id: 402, name: 'MIEL - Ø¹Ø³Ù„', description: 'Miel naturel pur', priceKg: null, priceUnit: 60.00, availableUnits: ['unit'], image: 'https://via.placeholder.com/400x300/f4a261/000000?text=MIEL', stockKg: 0, stockUnit: 25 },
                { id: 403, name: 'AMANDES - Ù„ÙˆØ²', description: 'Amandes dÃ©cortiquÃ©es', priceKg: 120.00, priceUnit: null, availableUnits: ['kg'], image: 'https://via.placeholder.com/400x300/f4a261/000000?text=AMANDES', stockKg: 10, stockUnit: 0 },
                { id: 404, name: 'NOIX - Ø¬ÙˆØ²', description: 'Noix dÃ©cortiquÃ©es', priceKg: 90.00, priceUnit: null, availableUnits: ['kg'], image: 'https://via.placeholder.com/400x300/f4a261/000000?text=NOIX', stockKg: 15, stockUnit: 0 },
                { id: 405, name: 'DATTES - ØªÙ…Ø±', description: 'Dattes Medjool', priceKg: 70.00, priceUnit: null, availableUnits: ['kg'], image: 'https://via.placeholder.com/400x300/f4a261/000000?text=DATTES', stockKg: 20, stockUnit: 0 },
                { id: 406, name: 'FIGUES SÃˆCHES - ØªÙŠÙ† Ù…Ø¬ÙÙ', description: 'Figues sÃ©chÃ©es', priceKg: 80.00, priceUnit: null, availableUnits: ['kg'], image: 'https://via.placeholder.com/400x300/f4a261/000000?text=FIGUES+SÃˆCHES', stockKg: 12, stockUnit: 0 }
            ],

            olives: [
                { id: 501, name: 'OLIVES VERTES - Ø²ÙŠØªÙˆÙ† Ø£Ø®Ø¶Ø±', description: 'Olives vertes marinÃ©es', priceKg: 30.00, priceUnit: 15.00, availableUnits: ['kg', 'unit'], image: 'https://via.placeholder.com/400x300/6a994e/ffffff?text=OLIVES+VERTES', stockKg: 25, stockUnit: 50 },
                { id: 502, name: 'OLIVES NOIRES - Ø²ÙŠØªÙˆÙ† Ø£Ø³ÙˆØ¯', description: 'Olives noires marinÃ©es', priceKg: 35.00, priceUnit: 18.00, availableUnits: ['kg', 'unit'], image: 'https://via.placeholder.com/400x300/6a994e/ffffff?text=OLIVES+NOIRES', stockKg: 20, stockUnit: 40 },
                { id: 503, name: 'OLIVES VIOLETTES - Ø²ÙŠØªÙˆÙ† Ø¨Ù†ÙØ³Ø¬ÙŠ', description: 'Olives violettes', priceKg: 32.00, priceUnit: 16.00, availableUnits: ['kg', 'unit'], image: 'https://via.placeholder.com/400x300/6a994e/ffffff?text=OLIVES+VIOLETTES', stockKg: 15, stockUnit: 30 },
                { id: 504, name: 'OLIVES FARCIES - Ø²ÙŠØªÙˆÙ† Ù…Ø­Ø´ÙŠ', description: 'Olives farcies aux amandes', priceKg: 40.00, priceUnit: 20.00, availableUnits: ['kg', 'unit'], image: 'https://via.placeholder.com/400x300/6a994e/ffffff?text=OLIVES+FARCIES', stockKg: 10, stockUnit: 25 },
                { id: 505, name: 'OLIVES AU CITRON - Ø²ÙŠØªÙˆÙ† Ø¨Ø§Ù„Ù„ÙŠÙ…ÙˆÙ†', description: 'Olives au citron confit', priceKg: 38.00, priceUnit: 19.00, availableUnits: ['kg', 'unit'], image: 'https://via.placeholder.com/400x300/6a994e/ffffff?text=OLIVES+AU+CITRON', stockKg: 18, stockUnit: 35 }
            ]
        };

        // ============================
        // INITIALIZATION
        // ============================

        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadCartFromStorage();
            updateCartDisplay();
        });

        function initializeApp() {
            renderCategories();
            renderProducts('legumes');
            updateCategoryCounts();
        }

        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Navigate to section
                    const target = this.getAttribute('href').replace('#', '');
                    if (target && productDatabase[target]) {
                        state.currentCategory = target;
                        renderProducts(target);
                        document.getElementById('pageTitle').textContent = `- ${getCategoryTitle(target)}`;
                    }
                });
            });

            // Category filter
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', function() {
                    const category = this.dataset.category;
                    state.currentCategory = category;
                    renderProducts(category);
                    document.getElementById('pageTitle').textContent = `- ${getCategoryTitle(category)}`;
                    
                    // Update active category
                    document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Sort select
            document.getElementById('sortSelect').addEventListener('change', function() {
                sortProducts(this.value);
            });

            // Cart icon
            document.getElementById('cartIcon').addEventListener('click', toggleCart);
            document.getElementById('floatingCartBtn').addEventListener('click', toggleCart);

            // Modal close
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.querySelector('.modal-overlay').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });

            // Cart close
            document.getElementById('closeCart').addEventListener('click', closeCart);
            
            // Checkout button
            document.getElementById('checkoutBtn').addEventListener('click', function() {
                if (state.cart.length > 0) {
                    showNotification('success', 'Commande validÃ©e', 'Votre commande a Ã©tÃ© enregistrÃ©e avec succÃ¨s !');
                    // In a real app, this would redirect to checkout
                    setTimeout(() => {
                        alert('Redirection vers le paiement...');
                        clearCart();
                    }, 1000);
                }
            });

            // Close cart on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    closeCart();
                }
            });
        }

        // ============================
        // RENDER FUNCTIONS
        // ============================

        function renderCategories() {
            const categoryList = document.getElementById('categoryList');
            const categories = [
                { id: 'epiceries', name: 'Ã‰PICERIES', count: productDatabase.epiceries.length },
                { id: 'fruits', name: 'FRUITS', count: productDatabase.fruits.length },
                { id: 'herbes', name: 'HERBES ET SALADES', count: productDatabase.herbes.length },
                { id: 'legumes', name: 'LÃ‰GUMES', count: productDatabase.legumes.length },
                { id: 'olives', name: 'OLIVES', count: productDatabase.olives.length },
                { id: 'surgeles', name: 'SURGELÃ‰S', count: 1 }
            ];

            categoryList.innerHTML = categories.map(cat => `
                <li class="category-item ${cat.id === state.currentCategory ? 'active' : ''}" data-category="${cat.id}">
                    <span>${cat.name}</span>
                    <span class="category-count">${cat.count}</span>
                </li>
            `).join('');
        }

        function renderProducts(category) {
            const productsGrid = document.getElementById('productsGrid');
            const products = productDatabase[category] || [];
            
            productsGrid.innerHTML = products.map(product => {
                const cartItem = state.cart.find(item => item.id === product.id);
                const quantity = cartItem ? cartItem.quantity : 0;
                
                return `
                    <div class="product-card" data-id="${product.id}">
                        <img src="${product.image}" alt="${product.name}" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-description">${product.description}</p>
                            <div class="product-price">
                                ${product.priceKg ? `${product.priceKg.toFixed(2)} DH/kg` : ''}
                                ${product.priceKg && product.priceUnit ? '<br>' : ''}
                                ${product.priceUnit ? `${product.priceUnit.toFixed(2)} DH/unitÃ©` : ''}
                            </div>
                            <button class="add-to-cart-btn" data-id="${product.id}">
                                <span>ðŸ›’</span>
                                <span>${quantity > 0 ? `(${quantity}) ` : ''}Ajouter Au Panier</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Add event listeners to "Add to cart" buttons
            document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.dataset.id);
                    const product = getProductById(productId);
                    if (product) {
                        openQuantityModal(product);
                    }
                });
            });
        }

        function updateCategoryCounts() {
            // Update counts in sidebar
            document.querySelectorAll('.category-item').forEach(item => {
                const category = item.dataset.category;
                if (category && productDatabase[category]) {
                    const countSpan = item.querySelector('.category-count');
                    if (countSpan) {
                        countSpan.textContent = productDatabase[category].length;
                    }
                }
            });
        }

        // ============================
        // QUANTITY MODAL
        // ============================

        function openQuantityModal(product) {
            state.currentProduct = product;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="product-preview">
                    <img src="${product.image}" alt="${product.name}" class="preview-image">
                    <div class="preview-info">
                        <h3>${product.name}</h3>
                        <p>${product.description}</p>
                        <div class="price">
                            ${product.priceKg ? `${product.priceKg.toFixed(2)} DH/kg` : ''}
                            ${product.priceKg && product.priceUnit ? ' | ' : ''}
                            ${product.priceUnit ? `${product.priceUnit.toFixed(2)} DH/unitÃ©` : ''}
                        </div>
                    </div>
                </div>

                <div class="unit-selection">
                    <h4 class="unit-title">Choisissez l'unitÃ© :</h4>
                    <div class="unit-options" id="unitOptions">
                        ${product.availableUnits.includes('kg') ? `
                            <div class="unit-option">
                                <button class="unit-btn" data-unit="kg">Par KG</button>
                                <div class="unit-price">${product.priceKg.toFixed(2)} DH/kg</div>
                            </div>
                        ` : ''}
                        
                        ${product.availableUnits.includes('unit') ? `
                            <div class="unit-option">
                                <button class="unit-btn" data-unit="unit">Par UnitÃ©</button>
                                <div class="unit-price">${product.priceUnit.toFixed(2)} DH/unitÃ©</div>
                            </div>
                        ` : ''}
                        
                        ${product.availableUnits.includes('package') ? `
                            <div class="unit-option">
                                <button class="unit-btn" data-unit="package">Par Paquet</button>
                                <div class="unit-price">${product.pricePackage.toFixed(2)} DH/paquet</div>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div class="quantity-selection">
                    <h4 class="quantity-title">QuantitÃ© :</h4>
                    <div class="quantity-control">
                        <button class="qty-btn" id="decreaseQty" disabled>âˆ’</button>
                        <div class="qty-display" id="qtyDisplay">1</div>
                        <button class="qty-btn" id="increaseQty">+</button>
                    </div>
                    <div class="total-price" id="totalPriceDisplay">
                        Total: ${product.availableUnits.includes('kg') ? product.priceKg.toFixed(2) : product.priceUnit.toFixed(2)} DH
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="modal-btn cancel-btn" id="cancelModal">
                        <span>âœ•</span>
                        <span>Annuler</span>
                    </button>
                    <button class="modal-btn add-btn" id="addToCartModal">
                        <span>ðŸ›’</span>
                        <span>Ajouter au panier</span>
                    </button>
                </div>
            `;

            // Set initial state
            let selectedUnit = product.availableUnits[0];
            let quantity = 1;
            let maxStock = selectedUnit === 'kg' ? product.stockKg : product.stockUnit;

            // Update modal event listeners
            updateModalEventListeners();

            function updateModalEventListeners() {
                // Unit selection
                document.querySelectorAll('.unit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.unit-btn').forEach(b => b.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedUnit = this.dataset.unit;
                        maxStock = selectedUnit === 'kg' ? product.stockKg : product.stockUnit;
                        
                        // Reset quantity to 1
                        quantity = 1;
                        updateQuantityDisplay();
                        updateButtons();
                    });
                });

                // Quantity buttons
                document.getElementById('decreaseQty').addEventListener('click', () => {
                    if (quantity > getMinQuantity()) {
                        quantity -= getIncrement();
                        updateQuantityDisplay();
                        updateButtons();
                    }
                });

                document.getElementById('increaseQty').addEventListener('click', () => {
                    if (quantity < maxStock) {
                        quantity += getIncrement();
                        updateQuantityDisplay();
                        updateButtons();
                    }
                });

                // Modal actions
                document.getElementById('cancelModal').addEventListener('click', closeModal);
                document.getElementById('addToCartModal').addEventListener('click', addToCartFromModal);
                
                // Set initial selection
                document.querySelector(`.unit-btn[data-unit="${selectedUnit}"]`).classList.add('selected');
                updateQuantityDisplay();
                updateButtons();
            }

            function getIncrement() {
                return selectedUnit === 'kg' ? 0.5 : 1;
            }

            function getMinQuantity() {
                return selectedUnit === 'kg' ? 0.5 : 1;
            }

            function updateQuantityDisplay() {
                document.getElementById('qtyDisplay').textContent = quantity;
                const unitPrice = selectedUnit === 'kg' ? product.priceKg : product.priceUnit;
                const total = quantity * unitPrice;
                document.getElementById('totalPriceDisplay').textContent = `Total: ${total.toFixed(2)} DH`;
            }

            function updateButtons() {
                const decreaseBtn = document.getElementById('decreaseQty');
                const increaseBtn = document.getElementById('increaseQty');
                
                decreaseBtn.disabled = quantity <= getMinQuantity();
                increaseBtn.disabled = quantity >= maxStock;
            }

            function addToCartFromModal() {
                const cartItem = state.cart.find(item => item.id === product.id && item.unit === selectedUnit);
                
                if (cartItem) {
                    // Update existing item
                    cartItem.quantity = quantity;
                } else {
                    // Add new item
                    state.cart.push({
                        id: product.id,
                        name: product.name,
                        description: product.description,
                        image: product.image,
                        unit: selectedUnit,
                        price: selectedUnit === 'kg' ? product.priceKg : product.priceUnit,
                        quantity: quantity
                    });
                }
                
                updateCartDisplay();
                closeModal();
                showNotification('success', 'Produit ajoutÃ©', `${product.name} a Ã©tÃ© ajoutÃ© au panier`);
            }

            // Open modal
            document.getElementById('quantityModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('quantityModal').classList.remove('active');
            state.currentProduct = null;
        }

        // ============================
        // CART MANAGEMENT
        // ============================

        function toggleCart() {
            document.getElementById('cartSidebar').classList.toggle('active');
        }

        function openCart() {
            document.getElementById('cartSidebar').classList.add('active');
        }

        function closeCart() {
            document.getElementById('cartSidebar').classList.remove('active');
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const floatingCartCount = document.getElementById('floatingCartCount');
            const subtotalPrice = document.getElementById('subtotalPrice');
            const deliveryPrice = document.getElementById('deliveryPrice');
            const totalPrice = document.getElementById('totalPrice');
            const checkoutBtn = document.getElementById('checkoutBtn');

            // Update counts
            const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            floatingCartCount.textContent = totalItems;

            // Calculate totals
            const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const delivery = subtotal >= state.freeDeliveryThreshold ? 0 : state.deliveryFee;
            const total = subtotal + delivery;

            // Update prices
            subtotalPrice.textContent = `${subtotal.toFixed(2)} DH`;
            deliveryPrice.textContent = delivery === 0 ? 'GRATUIT' : `${delivery.toFixed(2)} DH`;
            totalPrice.textContent = `${total.toFixed(2)} DH`;

            // Enable/disable checkout
            checkoutBtn.disabled = state.cart.length === 0;

            // Render cart items
            if (state.cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">ðŸ›’</div>
                        <h3>Votre panier est vide</h3>
                        <p>Ajoutez des produits pour commencer vos achats</p>
                    </div>
                `;
            } else {
                cartItems.innerHTML = state.cart.map((item, index) => {
                    const product = getProductById(item.id);
                    const maxStock = item.unit === 'kg' ? product.stockKg : product.stockUnit;
                    
                    return `
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">${item.price.toFixed(2)} DH/${item.unit === 'kg' ? 'kg' : 'unitÃ©'}</div>
                                <div class="cart-item-unit">${item.description}</div>
                            </div>
                            <div class="cart-item-controls">
                                <div class="cart-qty-control">
                                    <button class="cart-qty-btn" data-index="${index}" data-action="decrease">âˆ’</button>
                                    <div class="cart-qty-display">${item.quantity} ${item.unit === 'kg' ? 'kg' : 'unitÃ©(s)'}</div>
                                    <button class="cart-qty-btn" data-index="${index}" data-action="increase" ${item.quantity >= maxStock ? 'disabled' : ''}>+</button>
                                </div>
                                <button class="cart-item-remove" data-index="${index}">ðŸ—‘ï¸</button>
                            </div>
                        </div>
                    `;
                }).join('');

                // Add event listeners to cart controls
                document.querySelectorAll('.cart-qty-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const action = this.dataset.action;
                        updateCartItemQuantity(index, action);
                    });
                });

                document.querySelectorAll('.cart-item-remove').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        removeCartItem(index);
                    });
                });
            }

            // Update product displays
            updateProductDisplays();
            
            // Save cart to localStorage
            saveCartToStorage();
        }

        function updateCartItemQuantity(index, action) {
            if (index >= 0 && index < state.cart.length) {
                const item = state.cart[index];
                const product = getProductById(item.id);
                const maxStock = item.unit === 'kg' ? product.stockKg : product.stockUnit;
                
                if (action === 'increase' && item.quantity < maxStock) {
                    item.quantity += item.unit === 'kg' ? 0.5 : 1;
                } else if (action === 'decrease') {
                    const minQuantity = item.unit === 'kg' ? 0.5 : 1;
                    if (item.quantity > minQuantity) {
                        item.quantity -= item.unit === 'kg' ? 0.5 : 1;
                    } else {
                        // Remove item if quantity reaches minimum
                        state.cart.splice(index, 1);
                    }
                }
                
                updateCartDisplay();
            }
        }

        function removeCartItem(index) {
            if (index >= 0 && index < state.cart.length) {
                const removedItem = state.cart.splice(index, 1)[0];
                updateCartDisplay();
                showNotification('error', 'Produit retirÃ©', `${removedItem.name} a Ã©tÃ© retirÃ© du panier`);
            }
        }

        function clearCart() {
            state.cart = [];
            updateCartDisplay();
        }

        function updateProductDisplays() {
            // Update "Add to cart" buttons with quantities
            document.querySelectorAll('.product-card').forEach(card => {
                const productId = parseInt(card.dataset.id);
                const cartItem = state.cart.find(item => item.id === productId);
                const addButton = card.querySelector('.add-to-cart-btn');
                
                if (cartItem && addButton) {
                    addButton.innerHTML = `<span>ðŸ›’</span> <span>(${cartItem.quantity}) Ajouter Au Panier</span>`;
                } else if (addButton) {
                    addButton.innerHTML = `<span>ðŸ›’</span> <span>Ajouter Au Panier</span>`;
                }
            });
        }

        // ============================
        // HELPER FUNCTIONS
        // ============================

        function getProductById(id) {
            for (const category in productDatabase) {
                const product = productDatabase[category].find(p => p.id === id);
                if (product) return product;
            }
            return null;
        }

        function getCategoryTitle(category) {
            const titles = {
                legumes: 'LÃ‰GUMES',
                fruits: 'FRUITS',
                herbes: 'HERBES ET SALADES',
                epiceries: 'Ã‰PICERIES',
                olives: 'OLIVES',
                surgeles: 'SURGELÃ‰S'
            };
            return titles[category] || category.toUpperCase();
        }

        function sortProducts(criteria) {
            const products = productDatabase[state.currentCategory];
            if (!products) return;

            let sortedProducts;
            switch(criteria) {
                case 'Prix croissant':
                    sortedProducts = [...products].sort((a, b) => {
                        const priceA = a.priceKg || a.priceUnit || 0;
                        const priceB = b.priceKg || b.priceUnit || 0;
                        return priceA - priceB;
                    });
                    break;
                case 'Prix dÃ©croissant':
                    sortedProducts = [...products].sort((a, b) => {
                        const priceA = a.priceKg || a.priceUnit || 0;
                        const priceB = b.priceKg || b.priceUnit || 0;
                        return priceB - priceA;
                    });
                    break;
                case 'Nom A-Z':
                    sortedProducts = [...products].sort((a, b) => a.name.localeCompare(b.name));
                    break;
                default:
                    sortedProducts = products;
            }

            // Update product database temporarily for display
            productDatabase[state.currentCategory] = sortedProducts;
            renderProducts(state.currentCategory);
        }

        function showNotification(type, title, message) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');

            notification.className = `notification ${type}`;
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;

            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ============================
        // LOCAL STORAGE
        // ============================

        function saveCartToStorage() {
            try {
                localStorage.setItem('lepanierCart', JSON.stringify(state.cart));
                localStorage.setItem('lepanierCartTimestamp', Date.now().toString());
            } catch (e) {
                console.error('Erreur lors de la sauvegarde du panier:', e);
            }
        }

        function loadCartFromStorage() {
            try {
                const savedCart = localStorage.getItem('lepanierCart');
                const savedTimestamp = localStorage.getItem('lepanierCartTimestamp');
                
                if (savedCart && savedTimestamp) {
                    const timestamp = parseInt(savedTimestamp);
                    const now = Date.now();
                    const hoursElapsed = (now - timestamp) / (1000 * 60 * 60);
                    
                    // Load cart if it's less than 24 hours old
                    if (hoursElapsed < 24) {
                        state.cart = JSON.parse(savedCart);
                    } else {
                        // Clear old cart
                        localStorage.removeItem('lepanierCart');
                        localStorage.removeItem('lepanierCartTimestamp');
                    }
                }
            } catch (e) {
                console.error('Erreur lors du chargement du panier:', e);
                state.cart = [];
            }
        }

        // Auto-save cart every minute
        setInterval(saveCartToStorage, 60000);
    </script>
</body>
</html>